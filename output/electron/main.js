import{app as a,BrowserWindow as u,ipcMain as e}from"electron";import c from"path";import l from"fs/promises";const m=!a.isPackaged;async function d(){const r=a.getPath("userData"),t=c.join(r,"config");try{await l.mkdir(t,{recursive:!0})}catch(o){o instanceof Error?console.error("Error creando directorio de configuración:",o.message):console.error("Error creando directorio de configuración (tipo inesperado):",String(o))}return t}function f(){const r=new u({width:800,height:600,minWidth:200,minHeight:200,frame:!1,titleBarStyle:"hidden",webPreferences:{nodeIntegration:!1,contextIsolation:!0,webSecurity:!1,preload:c.join(process.cwd(),"output","electron","preload","preload.js")}});if(e.handle("window:minimize",()=>{r.minimize()}),e.handle("window:maximize",()=>(r.isMaximized()?r.unmaximize():r.maximize(),r.isMaximized())),e.handle("window:close",()=>{r.close()}),e.handle("window:isMaximized",()=>r.isMaximized()),e.handle("fs:saveUserConfigJson",async(t,o,i)=>{console.log("guardando settings");try{const n=await d(),s=c.join(n,`${o}.json`);return await l.writeFile(s,JSON.stringify(i,null,2),"utf-8"),{success:!0}}catch(n){let s;return n instanceof Error?s=n.message:s=String(n),console.error(`Error guardando ${o}.json:`,s),{success:!1,error:s}}}),e.handle("fs:loadUserConfigJson",async(t,o)=>{try{const i=await d(),n=c.join(i,`${o}.json`),s=await l.readFile(n,"utf-8");return{success:!0,data:JSON.parse(s)}}catch(i){return i instanceof Error?i.code==="ENOENT"?{success:!1,error:"FILE_NOT_FOUND"}:(console.error(`Error cargando ${o}.json:`,i.message),{success:!1,error:i.message}):(console.error(`Error cargando ${o}.json (tipo inesperado):`,String(i)),{success:!1,error:String(i)})}}),e.handle("fs:userConfigExists",async(t,o)=>{try{const i=await d(),n=c.join(i,`${o}.json`);return await l.access(n),!0}catch{return!1}}),m)r.loadURL("http://localhost:5173").catch(()=>{console.log("Dev server not ready, retrying..."),setTimeout(()=>r.loadURL("http://localhost:5173"),1e3)});else{const t=c.join(process.cwd(),"output","dist","index.html");r.loadFile(t)}}a.whenReady().then(()=>{f(),a.on("activate",function(){u.getAllWindows().length===0&&f()})});a.on("window-all-closed",function(){process.platform!=="darwin"&&a.quit()});a.on("before-quit",()=>{e.removeAllListeners("window:minimize"),e.removeAllListeners("window:maximize"),e.removeAllListeners("window:close"),e.removeAllListeners("window:isMaximized"),e.removeAllListeners("fs:saveUserConfigJson"),e.removeAllListeners("fs:loadUserConfigJson"),e.removeAllListeners("fs:userConfigExists")});
