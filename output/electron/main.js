import{app as a,BrowserWindow as u,ipcMain as e}from"electron";import c from"path";import l from"fs/promises";const m=!a.isPackaged;function w(){return a.getPath("userData")}async function d(){const r=c.join(w(),"config");try{await l.mkdir(r,{recursive:!0})}catch(n){n instanceof Error?console.error("Error creando directorio de configuración:",n.message):console.error("Error creando directorio de configuración (tipo inesperado):",String(n))}return r}function f(){const r=new u({width:800,height:600,minWidth:200,minHeight:200,frame:!1,titleBarStyle:"hidden",webPreferences:{nodeIntegration:!1,contextIsolation:!0,webSecurity:!1,preload:c.join(process.cwd(),"output","electron","preload","preload.js")}});if(e.handle("window:minimize",()=>{r.minimize()}),e.handle("window:maximize",()=>(r.isMaximized()?r.unmaximize():r.maximize(),r.isMaximized())),e.handle("window:close",()=>{r.close()}),e.handle("window:isMaximized",()=>r.isMaximized()),e.handle("fs:saveJson",async(n,s,o)=>{try{const i=await d(),t=c.join(i,`${s}.json`);return await l.writeFile(t,JSON.stringify(o,null,2),"utf-8"),{success:!0}}catch(i){let t;return i instanceof Error?t=i.message:t=String(i),console.error(`Error guardando ${s}.json:`,t),{success:!1,error:t}}}),e.handle("fs:loadJson",async(n,s)=>{try{const o=await d(),i=c.join(o,`${s}.json`),t=await l.readFile(i,"utf-8");return{success:!0,data:JSON.parse(t)}}catch(o){return o instanceof Error?o.code==="ENOENT"?{success:!1,error:"FILE_NOT_FOUND"}:(console.error(`Error cargando ${s}.json:`,o.message),{success:!1,error:o.message}):(console.error(`Error cargando ${s}.json (tipo inesperado):`,String(o)),{success:!1,error:String(o)})}}),e.handle("fs:exists",async(n,s)=>{try{const o=await d(),i=c.join(o,`${s}.json`);return await l.access(i),!0}catch{return!1}}),m)r.loadURL("http://localhost:5173").catch(()=>{console.log("Dev server not ready, retrying..."),setTimeout(()=>r.loadURL("http://localhost:5173"),1e3)});else{const n=c.join(process.cwd(),"output","dist","index.html");r.loadFile(n)}}a.whenReady().then(()=>{f(),a.on("activate",function(){u.getAllWindows().length===0&&f()})});a.on("window-all-closed",function(){process.platform!=="darwin"&&a.quit()});a.on("before-quit",()=>{e.removeAllListeners("window:minimize"),e.removeAllListeners("window:maximize"),e.removeAllListeners("window:close"),e.removeAllListeners("window:isMaximized"),e.removeAllListeners("fs:saveJson"),e.removeAllListeners("fs:loadJson"),e.removeAllListeners("fs:exists")});
